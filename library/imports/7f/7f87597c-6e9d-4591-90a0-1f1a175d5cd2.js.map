{"version":3,"sources":["assets\\script\\tscript\\ui\\main\\WXOpenDataUI.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import WXSdk from \"../../wx/WXSdk\";\r\n\r\n// Learn TypeScript:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/typescript.html\r\n//  - [English] http://www.cocos2d-x.org/docs/creator/manual/en/scripting/typescript.html\r\n// Learn Attribute:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\r\n//  - [English] http://www.cocos2d-x.org/docs/creator/manual/en/scripting/reference/attributes.html\r\n// Learn life-cycle callbacks:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\r\n//  - [English] http://www.cocos2d-x.org/docs/creator/manual/en/scripting/life-cycle-callbacks.html\r\n\r\nconst {ccclass, property} = cc._decorator;\r\n\r\n@ccclass\r\nexport default class WXOpenDataUI extends cc.Component {\r\n\r\n    @property(cc.Button)\r\n    public turnbackBtn:cc.Button = null;\r\n\r\n    @property(cc.Button)\r\n    public shareBtn:cc.Button = null;\r\n\r\n    @property(cc.Sprite)\r\n    public openDataCanvasDisPlay:cc.Sprite = null;\r\n\r\n    @property(cc.SpriteFrame)\r\n    public shareBtnSkinArr:cc.SpriteFrame[] = []\r\n\r\n\r\n    private shareIndex:number = 1;\r\n\r\n    private showOpenData:boolean = false;\r\n\r\n    private tex:cc.Texture2D = new cc.Texture2D();\r\n\r\n    private wxSubContext:cc.WXSubContextView = null;\r\n\r\n    // LIFE-CYCLE CALLBACKS:\r\n\r\n    // onLoad () {}\r\n\r\n    start () {\r\n\r\n        if(!WXSdk.instance.isWXPlatform())\r\n        {\r\n            this.node.active = false;\r\n            return;\r\n        }\r\n\r\n        this.turnbackBtn.node.on(cc.Node.EventType.TOUCH_END,(event:cc.Event.EventTouch)=>\r\n        {\r\n            this.closeOpenDataField();\r\n        },this);\r\n\r\n        this.shareBtn.node.on(cc.Node.EventType.TOUCH_END,(event:cc.Event.EventTouch)=>\r\n        {\r\n            WXSdk.instance.shareToAnyOne(()=>{},()=>{});\r\n        },this);\r\n\r\n        this.wxSubContext = this.getComponent(cc.WXSubContextView);\r\n\r\n        this.openDataCanvasDisPlay = this.getComponent(cc.Sprite);\r\n        \r\n\r\n        //this.wxSubContext.enabled = false;\r\n        //this.wxSubContext.updateSubContextViewport();\r\n        this.updateOpenDataCanvas();\r\n\r\n        if(!this.showOpenData)\r\n        {\r\n            this.node.active = false;\r\n        }\r\n\r\n        cc.systemEvent.on(\"shareTicketUpdate\",this.onShareTicketUpdate,this);\r\n    }\r\n\r\n    private onShareTicketUpdate()\r\n    {\r\n        if(!this.showOpenData)\r\n            return;\r\n\r\n        if(WXSdk.instance.shareTicket != \"\")\r\n        {\r\n            this.openGroupRankUI();\r\n        }\r\n    }\r\n\r\n    onDestroy()\r\n    { \r\n        cc.systemEvent.off(\"shareTicketUpdate\",this.onShareTicketUpdate,this);   \r\n    }\r\n\r\n    // update (dt) {}\r\n\r\n    update(dt)\r\n    {\r\n        if(this.showOpenData)\r\n        {\r\n            this.updateOpenDataCanvas();\r\n        }\r\n    }\r\n\r\n    updateOpenDataCanvas()\r\n    {\r\n        this.tex.initWithElement(WXSdk.instance.sharedCanvas);\r\n        this.tex.handleLoadedTexture();\r\n        this.openDataCanvasDisPlay.spriteFrame.setTexture(this.tex);\r\n        //this.openDataCanvasDisPlay.spriteFrame = new cc.SpriteFrame(this.tex);\r\n    }\r\n\r\n    /**\r\n     * 显示开发数据域\r\n     */\r\n    public showOpenDataField()\r\n    {\r\n        if(!WXSdk.instance.isWXPlatform())\r\n        {\r\n            return;\r\n        }\r\n\r\n        //this.wxSubContext = this.getComponent(cc.WXSubContextView);\r\n        this.showOpenData = true;\r\n        this.node.active = true\r\n\r\n        //this.wxSubContext.enabled = true;\r\n        //(this.wxSubContext[\"update\"] as Function)();\r\n    }\r\n\r\n\r\n    public openRankUI()\r\n    {\r\n        if(WXSdk.instance.shareTicket != \"\")\r\n        {\r\n            this.openGroupRankUI();\r\n        }else\r\n        {\r\n\r\n            WXSdk.instance.getUserScoreWorldRank((data)=>{\r\n                this.openWorldRankUI(data);\r\n            },()=>{});\r\n\r\n            //this.openFriendRankUI();\r\n        }\r\n\r\n    }\r\n\r\n    /**\r\n     * 打开好友排行榜\r\n     */\r\n    public openFriendRankUI()\r\n    {\r\n        if(!WXSdk.instance.isWXPlatform())\r\n        {\r\n            return;\r\n        }\r\n\r\n        this.shareIndex = 1;\r\n        this.shareBtn.node.getChildByName(\"Background\").getComponent(cc.Sprite).spriteFrame = this.shareBtnSkinArr[this.shareIndex - 1];\r\n\r\n        this.showOpenDataField();\r\n        WXSdk.instance.wx.postMessage({name:\"friend\"});\r\n    }\r\n\r\n    /**\r\n     * 打开群排行榜\r\n     */\r\n    public openGroupRankUI()\r\n    {\r\n        if(!WXSdk.instance.isWXPlatform())\r\n        {\r\n            return;\r\n        }\r\n\r\n        this.shareIndex = 2;\r\n        this.shareBtn.node.getChildByName(\"Background\").getComponent(cc.Sprite).spriteFrame = this.shareBtnSkinArr[this.shareIndex - 1];\r\n\r\n\r\n        this.showOpenDataField();\r\n        WXSdk.instance.wx.postMessage({name:\"group\",shareTicket:WXSdk.instance.shareTicket});\r\n    }\r\n\r\n    /**\r\n     * 打开世界排行榜\r\n     */\r\n    public openWorldRankUI(rankData:any)\r\n    {\r\n        if(!WXSdk.instance.isWXPlatform())\r\n        {\r\n            return;\r\n        }\r\n\r\n        this.shareIndex = 3;\r\n        this.shareBtn.node.getChildByName(\"Background\").getComponent(cc.Sprite).spriteFrame = this.shareBtnSkinArr[this.shareIndex - 1];\r\n\r\n        this.showOpenDataField();\r\n        WXSdk.instance.wx.postMessage({name:\"world\",rankData:rankData});\r\n    }\r\n\r\n    /**\r\n     * 关闭开放数据域\r\n     */\r\n    public closeOpenDataField()\r\n    {\r\n        if(!WXSdk.instance.isWXPlatform())\r\n        {\r\n            return;\r\n        }\r\n        this.showOpenData = false;\r\n        this.node.active = false;\r\n\r\n        WXSdk.instance.wx.postMessage({name:\"close\"});\r\n        //this.wxSubContext = this.getComponent(cc.WXSubContextView);\r\n        //this.wxSubContext.enabled = false;\r\n        //(this.wxSubContext[\"update\"] as Function)();\r\n    }\r\n\r\n}\r\n"]}