{"version":3,"sources":["assets\\script\\tscript\\gamescene\\PlayerController.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import Player, { PlayerStatus } from \"./Player\";\r\nimport GameManager, { GameStatus } from \"../core/GameManager\";\r\nimport Vector2 from \"../util/Vector2\";\r\nimport Mathf from \"../util/Mathf\";\r\nimport Joystick from \"./Joystick\";\r\nimport CommonUils from \"../util/CommonUils\";\r\n\r\n// Learn TypeScript:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/typescript.html\r\n//  - [English] http://www.cocos2d-x.org/docs/creator/manual/en/scripting/typescript.html\r\n// Learn Attribute:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\r\n//  - [English] http://www.cocos2d-x.org/docs/creator/manual/en/scripting/reference/attributes.html\r\n// Learn life-cycle callbacks:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\r\n//  - [English] http://www.cocos2d-x.org/docs/creator/manual/en/scripting/life-cycle-callbacks.html\r\n\r\nconst {ccclass, property} = cc._decorator;\r\n\r\n@ccclass\r\nexport default class PlayerController extends cc.Component {\r\n\r\n    \r\n    public player:Player = null;\r\n\r\n    private touchPos:cc.Vec2 = cc.Vec2.ZERO;\r\n\r\n\r\n    private baseZoom:number = 1;\r\n    \r\n    private targetZoom:number = 1;\r\n\r\n    public zoomRatio:number = 1;\r\n\r\n    private joyStick:Joystick = null;\r\n    \r\n\r\n    //private currentZoomVec:cc.Vec2 = cc.Vec2.ZERO;\r\n\r\n    // LIFE-CYCLE CALLBACKS:\r\n\r\n    // onLoad () {}\r\n\r\n    start () {\r\n\r\n        //this.currentZoomVec.x = cc.Camera.main.zoomRatio;\r\n        this.baseZoom = cc.Camera.main.zoomRatio;\r\n        this.targetZoom = cc.Camera.main.zoomRatio;\r\n\r\n        this.player = this.getComponent(Player);\r\n\r\n        this.joyStick = GameManager.instance.joystick;\r\n\r\n        //cc.log(\"lerp\",Mathf.lerp(0.5,1,0.5));\r\n\r\n        if(this.player.isAI)\r\n        {\r\n            return;\r\n        }\r\n\r\n\r\n        var touchPlane:cc.Node = GameManager.instance.touchPlane;\r\n\r\n        touchPlane.on(cc.Node.EventType.TOUCH_START,(event:cc.Event.EventTouch)=>\r\n        {\r\n\r\n            if(!this.player || this.player.status == PlayerStatus.die)\r\n            {\r\n                return;\r\n            }\r\n            this.touchPos = event.getLocation();\r\n            this.player.changeAttackState();\r\n\r\n            if(GameManager.instance.gameStatus == GameStatus.start)\r\n            {\r\n                this.zoomRatio = 0.75;\r\n\r\n                this.joyStick.node.position = cc.v2(event.getLocation().x - cc.winSize.width * 0.5,event.getLocation().y - cc.winSize.height * 0.5);\r\n                this.joyStick.show();\r\n            }\r\n\r\n            this.player.circle.active = false;\r\n            \r\n        });\r\n\r\n        touchPlane.on(cc.Node.EventType.TOUCH_MOVE,(event:cc.Event.EventTouch)=>\r\n        {\r\n            \r\n            if(GameManager.instance.gameStatus != GameStatus.start)\r\n            {\r\n                this.player.moveDir = cc.Vec2.ZERO;\r\n                return;\r\n            }\r\n\r\n            if(!this.player || this.player.status == PlayerStatus.die)\r\n            {\r\n                return;\r\n            }\r\n\r\n            var currentPos = event.getLocation();\r\n            this.player.moveDir = currentPos.sub(this.touchPos).normalize();\r\n            this.joyStick.cursorTo(this.player.moveDir);\r\n            //this.player.moveDir = event.getDelta().normalize();\r\n        });\r\n\r\n        touchPlane.on(cc.Node.EventType.TOUCH_END,(event:cc.Event.EventTouch)=>\r\n        {\r\n            if(!this.player || this.player.status == PlayerStatus.die)\r\n            {\r\n                return;\r\n            }\r\n\r\n            this.player.moveDir = cc.Vec2.ZERO;\r\n            this.player.changeDefenceState();\r\n            this.zoomRatio = 1;\r\n\r\n            if(GameManager.instance.gameStatus == GameStatus.start)\r\n            {\r\n                this.player.circle.active = true;\r\n            }\r\n\r\n            this.joyStick.hidden();\r\n\r\n        });\r\n\r\n        touchPlane.on(cc.Node.EventType.TOUCH_CANCEL,(event:cc.Event.EventTouch)=>\r\n        {\r\n            if(!this.player || this.player.status == PlayerStatus.die)\r\n            {\r\n                return;\r\n            }\r\n\r\n            this.player.moveDir = cc.Vec2.ZERO;\r\n            this.player.changeDefenceState();\r\n            this.zoomRatio = 1;\r\n            if(GameManager.instance.gameStatus == GameStatus.start)\r\n            {\r\n                this.player.circle.active = true;\r\n            }\r\n\r\n            this.joyStick.hidden();\r\n\r\n        });\r\n\r\n\r\n    }\r\n\r\n    update (dt) \r\n    {\r\n        //cc.Camera.main.zoomRatio = Mathf.lerp(cc.Camera.main.zoomRatio,this.targetZoom,dt);\r\n        //var vec2:cc.Vec2 = Vector2.lerp(this.currentZoomVec,this.targetZoomVec,dt * 5);\r\n        //cc.Camera.main.zoomRatio = vec2.x;\r\n\r\n        if(this.player.isAI)\r\n        {\r\n           return;   \r\n        }\r\n\r\n        this.targetZoom = (this.baseZoom / this.player.size) * this.zoomRatio;\r\n        cc.Camera.main.zoomRatio = Mathf.lerp(cc.Camera.main.zoomRatio,this.targetZoom,dt * 5);\r\n\r\n    }\r\n}\r\n"]}