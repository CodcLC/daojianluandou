{"version":3,"sources":["assets\\script\\tscript\\core\\DataManager.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["\r\nimport ResourcesManager from \"./ResourcesManager\";\r\nimport DataStorage from \"./DataStorage\";\r\nimport PlayerData from \"../data/PlayerData\";\r\nimport LevelData from \"../data/LevelData\";\r\nimport NameConfigData from \"../configdata/NameConfigData\";\r\nimport LevelConfigData from \"../configdata/LevelConfigData\";\r\nimport KnifeConfigData from \"../configdata/KnifeConfigData\";\r\nimport CustomEventType from \"../event/CustomEventType\";\r\nimport AccountRankData from \"../configdata/AccountRankData\";\r\n\r\n// Learn TypeScript:\r\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/typescript.html\r\n//  - [English] http://www.cocos2d-x.org/docs/creator/manual/en/scripting/typescript.html\r\n// Learn Attribute:\r\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\r\n//  - [English] http://www.cocos2d-x.org/docs/creator/manual/en/scripting/reference/attributes.html\r\n// Learn life-cycle callbacks:\r\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\r\n//  - [English] http://www.cocos2d-x.org/docs/creator/manual/en/scripting/life-cycle-callbacks.html\r\n\r\nconst {ccclass, property} = cc._decorator;\r\n\r\n@ccclass\r\nexport default class DataManager extends cc.Component {\r\n\r\n    private static _instance: DataManager;\r\n    public static get instance(): DataManager {\r\n        if(this._instance == null)\r\n        {\r\n            this._instance = new DataManager();\r\n            this._instance.init();\r\n        }\r\n        return DataManager._instance;\r\n    }\r\n\r\n    /**\r\n     * 玩家数据\r\n     */\r\n    private _playerData:PlayerData = null;\r\n\r\n    private _levelData:LevelData = null;\r\n    \r\n\r\n    private _nameConfigDatas: NameConfigData[] = null;\r\n    public get nameConfigDatas(): NameConfigData[] \r\n    {\r\n        return this._nameConfigDatas;\r\n    }\r\n\r\n    private _levelConfigDatas: LevelConfigData[] = null;\r\n    public get levelConfigDatas(): LevelConfigData[] \r\n    {\r\n        return this._levelConfigDatas;\r\n    }\r\n\r\n    private _knifeConfigDatas: KnifeConfigData[] = null;\r\n    public get knifeConfigDatas(): KnifeConfigData[] {\r\n        return this._knifeConfigDatas;\r\n    }\r\n\r\n\r\n    private _accountRankConfigDatas: AccountRankData[] = null;\r\n    public get accountRankConfigDatas(): AccountRankData[] {\r\n        return this._accountRankConfigDatas;\r\n    }\r\n\r\n    private _accountRankCnfDatasDic: {\r\n        [key: number]: AccountRankData[];\r\n    } = {};\r\n\r\n    public get accountRankCnfDatasDic(): {\r\n        [key: number]: AccountRankData[];\r\n    } {\r\n        return this._accountRankCnfDatasDic;\r\n    }\r\n\r\n    private _ctlevelConfigDatas: LevelConfigData[] = [];\r\n    public get ctlevelConfigDatas(): LevelConfigData[] \r\n    {\r\n        return this._ctlevelConfigDatas;\r\n    }\r\n\r\n\r\n    private _isJosnLoaded = false;\r\n\r\n    private init()\r\n    {\r\n        /**发布版本一点要删除 */\r\n\r\n        //DataStorage.removeItem(\"playerData\");\r\n        //DataStorage.removeItem(\"levelData\");\r\n        //DataStorage.removeItem(\"day\");\r\n\r\n    }\r\n\r\n    //加载配置数据\r\n    public loadConfigDatas(callback:Function)\r\n    {\r\n        if(this._isJosnLoaded)\r\n        {\r\n            callback();\r\n            return;\r\n        }\r\n\r\n        var jsonArr = [\"LevelTable\",\"NameTable\",\"KnifeTable\",\"AccountRankTable\"];\r\n        \r\n        var resMgr = ResourcesManager.instance;\r\n\r\n\r\n        resMgr.loadJson(\"LevelTable\",(data,jsonName)=>{this._levelConfigDatas = data; removeJsonitem(jsonName);});\r\n        resMgr.loadJson(\"NameTable\",(data,jsonName)=>{this._nameConfigDatas = data;removeJsonitem(jsonName);});\r\n        resMgr.loadJson(\"KnifeTable\",(data,jsonName)=>{this._knifeConfigDatas = data;removeJsonitem(jsonName);});\r\n        resMgr.loadJson(\"AccountRankTable\",(data,jsonName)=>{this._accountRankConfigDatas = data;removeJsonitem(jsonName);});\r\n        \r\n        this.schedule(wait,0.02);\r\n        var self = this;\r\n\r\n\r\n        function wait()\r\n        {\r\n            if(jsonArr.length == 0)\r\n            {\r\n                this.onConfigDataLoadComp();\r\n                callback();\r\n                self.unschedule(wait);\r\n                self._isJosnLoaded = true;\r\n            }\r\n        }\r\n\r\n        function removeJsonitem(item:string)\r\n        {\r\n            var index = jsonArr.indexOf(item);\r\n            if(index >= 0)\r\n            {\r\n                jsonArr.splice(index,1);\r\n            }\r\n        }\r\n    }\r\n\r\n    private onConfigDataLoadComp()\r\n    {\r\n\r\n        var len:number = this._accountRankConfigDatas.length;\r\n\r\n        for(var i = 0 ; i < len; i++)\r\n        {\r\n            var arcnfdata = this._accountRankConfigDatas[i];\r\n\r\n            if(!this._accountRankCnfDatasDic[arcnfdata.level])\r\n            {\r\n                this._accountRankCnfDatasDic[arcnfdata.level] = [];\r\n            }\r\n\r\n            this._accountRankCnfDatasDic[arcnfdata.level].push(arcnfdata);\r\n        }\r\n\r\n        len = this._levelConfigDatas.length;\r\n\r\n        for(var i = 0 ; i < len; i++)\r\n        {\r\n            var levelcnfdata:LevelConfigData = this._levelConfigDatas[i];\r\n\r\n            if(levelcnfdata.contentType == 0)\r\n            {\r\n                continue;\r\n            }\r\n\r\n            this._ctlevelConfigDatas.push(levelcnfdata);\r\n\r\n        }\r\n\r\n        this.updateDataEveryDay();\r\n    }\r\n\r\n   \r\n    private updateDataEveryDay()\r\n    {\r\n        //DataStorage.setItem(\"day\",\"2018/11/22\");\r\n        \r\n        var yesterday:Date = new Date();\r\n        yesterday.setDate(yesterday.getDate() - 1);\r\n\r\n        var lastDay:string = DataStorage.getItem(\"day\",this.getLocaleDateString(yesterday));\r\n\r\n        //cc.log(\"上次登录时间\",lastDay,DataStorage.getItem(\"day\",\"没存储\"));\r\n        //var date1:Date = new Date(\"2018/11/15 00:00:00\");\r\n        var lastDate:Date = new Date(lastDay); //上一次的日期\r\n       \r\n        var nowDate:Date = new Date(this.getLocaleDateString(new Date())); //现在的日期\r\n\r\n        var dateDifc = (nowDate.getTime() - lastDate.getTime()) / 86400000;\r\n\r\n        //cc.log(\"dateDifc\",dateDifc,this.getLocaleDateString(nowDate),this.getLocaleDateString(new Date()),this.getSignInData().lastLoginDay);\r\n\r\n        var checkTimer = function(dt)\r\n        {\r\n            nowDate = new Date();\r\n\r\n            if(nowDate.getHours()>=6)//每天凌晨6点钟刷新数据\r\n            {\r\n                cc.log(\"新的一天到了\");\r\n                \r\n                this.getPlayerData().logindays ++;\r\n                this.getPlayerData().todayUseFace = false; //每天重置表情是否试用\r\n                this.savePlayerData();\r\n\r\n                this.unschedule(checkTimer);\r\n\r\n                DataStorage.setItem(\"day\",this.getLocaleDateString(nowDate));\r\n\r\n                cc.systemEvent.emit(CustomEventType.NewDay);\r\n            }\r\n            \r\n        }.bind(this);\r\n\r\n        //this.scheduleOnce(checkTimer,1.25);//首次快速更新一下\r\n\r\n        if(dateDifc >= 1)//如果是新的一天\r\n        {\r\n            this.schedule(checkTimer,5);\r\n            checkTimer(0);\r\n            \r\n        }else if(dateDifc < 0)\r\n        {\r\n            //cc.log(\"用户手动调了系统时间\");\r\n            //this.schedule(checkTimer,5);\r\n            //checkTimer(0);\r\n            DataStorage.setItem(\"day\",this.getLocaleDateString(nowDate));//重新存储当前时间\r\n        }\r\n    }\r\n\r\n    public getLocaleDateString(date:Date):string\r\n    {\r\n        //\"2018/11/22\"\r\n        var year:string = date.getFullYear().toString();\r\n        var mon:number = date.getMonth() + 1;\r\n        var month:string = mon < 10 ? \"0\" + mon : mon.toString();\r\n        var day:string = date.getDate() < 10 ? \"0\" + date.getDate() : date.getDate().toString();\r\n\r\n        return year + \"/\" + month + \"/\" + day;\r\n\r\n    }\r\n\r\n    public getNowTime():number\r\n    {\r\n        return Date.now();\r\n    }\r\n\r\n\r\n    public getPlayerData():PlayerData\r\n    {\r\n        if(this._playerData == null)\r\n        {\r\n            this._playerData = new PlayerData();\r\n            var localData:PlayerData = JSON.parse(DataStorage.getItem(\"playerData\"));\r\n\r\n            if(localData)\r\n            {\r\n                for(var key in localData)\r\n                {\r\n                    if(typeof this._playerData[key] != \"undefined\")\r\n                    {\r\n                        this._playerData[key] = localData[key];\r\n                    }\r\n                }\r\n            }\r\n\r\n            //cc.log(\"playerdata\",this._playerData);\r\n        }\r\n\r\n        return this._playerData;\r\n    }\r\n    \r\n    public savePlayerData():void\r\n    {\r\n        DataStorage.setItem(\"playerData\",JSON.stringify(this._playerData));\r\n    }\r\n\r\n    public getLevelData():LevelData\r\n    {\r\n        if(this._levelData == null)\r\n        {\r\n            this._levelData = new LevelData();\r\n            var localData:PlayerData = JSON.parse(DataStorage.getItem(\"levelData\"));\r\n\r\n            if(localData)\r\n            {\r\n                for(var key in localData)\r\n                {\r\n                    if(typeof this._levelData[key] != \"undefined\")\r\n                    {\r\n                        this._levelData[key] = localData[key];\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        return this._levelData;\r\n    }\r\n\r\n    public saveLevelData():void\r\n    {\r\n        DataStorage.setItem(\"levelData\",JSON.stringify(this._levelData));\r\n    }\r\n\r\n\r\n    public getNameConfigData(id:number):NameConfigData\r\n    {\r\n        if(id <= 0)\r\n            return null;\r\n        return this._nameConfigDatas[id - 1];\r\n    }\r\n\r\n    public getLevelConfigData(id:number):LevelConfigData\r\n    {\r\n        if(id <= 0)\r\n            return null;\r\n        return this._levelConfigDatas[id - 1];\r\n    }\r\n\r\n    public getKnifeConfigData(id:number):KnifeConfigData\r\n    {\r\n        if(id <= 0)\r\n            return null;\r\n        return this._knifeConfigDatas[id - 1];\r\n    }\r\n\r\n    public getLevelId(star:number):number\r\n    {\r\n        var leveCnfdatas = this.levelConfigDatas;\r\n\r\n        var index:number = 0;\r\n\r\n        if(star >= leveCnfdatas[leveCnfdatas.length - 1].stars)\r\n        {\r\n            index = leveCnfdatas.length - 1; \r\n        }else\r\n        {\r\n            for(var i = 0 ; i < leveCnfdatas.length - 1; i++)\r\n            {\r\n                if(star >= leveCnfdatas[i].stars && star < leveCnfdatas[i + 1].stars)\r\n                {\r\n                    index = i;\r\n                    break;\r\n                }\r\n                \r\n            }\r\n        }\r\n\r\n        return leveCnfdatas[index].id;\r\n\r\n    }\r\n\r\n    public getLevel(star:number):number\r\n    {\r\n        var levelId = this.getLevelId(star);\r\n        var levelcnfdata:LevelConfigData = DataManager.instance.levelConfigDatas[levelId - 1];\r\n        return levelcnfdata.level\r\n    }\r\n\r\n    // update (dt) {}\r\n}\r\n\r\n"]}