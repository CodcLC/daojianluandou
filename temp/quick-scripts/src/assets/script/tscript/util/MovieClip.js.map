{"version":3,"sources":["assets\\script\\tscript\\util\\MovieClip.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import Mathf from \"./Mathf\";\r\n\r\n// Learn TypeScript:\r\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/typescript.html\r\n//  - [English] http://www.cocos2d-x.org/docs/creator/manual/en/scripting/typescript.html\r\n// Learn Attribute:\r\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\r\n//  - [English] http://www.cocos2d-x.org/docs/creator/manual/en/scripting/reference/attributes.html\r\n// Learn life-cycle callbacks:\r\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\r\n//  - [English] http://www.cocos2d-x.org/docs/creator/manual/en/scripting/life-cycle-callbacks.html\r\n\r\nconst {ccclass, property} = cc._decorator;\r\n\r\n@ccclass\r\nexport default class MovieClip extends cc.Component {\r\n\r\n    /// <summary>\r\n    /// Sprite渲染器\r\n    /// </summary>\r\n    protected m_sprite:cc.Sprite = null;;\r\n\r\n\r\n    /// <summary>\r\n    /// 动画计时间隔 每隔0.1s更新一帧\r\n    /// </summary>\r\n    protected timer:number = 0.1;\r\n\r\n    /// <summary>\r\n    /// 播放 时间 间隔\r\n    /// </summary>\r\n    @property(cc.Float)\r\n    public interval:number = 0.1;\r\n\r\n    /// <summary>\r\n    /// 贴图文件名\r\n    /// </summary>\r\n    @property({type:cc.Texture2D})\r\n    public texture:cc.Texture2D = null;\r\n\r\n    /// <summary>\r\n    /// 播放次数\r\n    /// </summary>\r\n    @property({type:cc.Integer})\r\n    public playTimes:number = 0;\r\n\r\n    /// <summary>\r\n    /// 图片切割成几行\r\n    /// </summary>\r\n\r\n    @property(cc.Integer)\r\n    public row:number = 4;\r\n\r\n    /// <summary>\r\n    /// 图片切割成几列\r\n    /// </summary>\r\n    @property(cc.Integer)\r\n    public col:number = 4;\r\n\r\n    @property(cc.Integer)\r\n    public rowIndex:number = 0;\r\n\r\n    @property(cc.Boolean)\r\n    public isAll:boolean = false;\r\n\r\n    @property(cc.Boolean)\r\n    public autoPlayOnLoad:boolean = true;\r\n\r\n    /// <summary>\r\n    /// 播放完自动销毁\r\n    /// </summary>\r\n    @property(cc.Boolean)\r\n    public autoDestroy:boolean = false;\r\n\r\n\r\n    private begin:number = 0;\r\n\r\n    private end:number = 4;\r\n\r\n    /// <summary>\r\n    /// 动画帧数\r\n    /// </summary>\r\n    public totalFrame:number = 8;\r\n\r\n    /// <summary>\r\n    /// 当前帧数\r\n    /// </summary>\r\n    public currentFrame:number = 0;\r\n\r\n    /**\r\n     * 当前播放了第几次\r\n     */\r\n    private currentTimes:number = 0;\r\n\r\n    /// <summary>\r\n    /// 影片是否在跑动中\r\n    /// </summary>\r\n    public running:boolean = true;\r\n\r\n    //private _direction:number = 1;\r\n\r\n    private _playIndex:number = 0;\r\n\r\n    private _pieceWidth:number = 0;\r\n\r\n    private _pieceHeight:number = 0;\r\n\r\n    private rect:cc.Rect = new cc.Rect();\r\n\r\n\r\n    // Use this for initialization\r\n    start()\r\n    {\r\n\r\n        //this. m_clips = new cc.SpriteFrame[this.row][this.col];\r\n        //Texture2D tex = Resources.Load<Texture2D>(\"Image/Avatar/\" + m_sprite_name);\r\n\r\n        this.begin = 0;\r\n        this.end = this.col;\r\n\r\n        this.rowIndex = Mathf.clamp(this.rowIndex,0,this.row - 1);\r\n\r\n\r\n        this._pieceWidth = this.texture.width / this.col;\r\n        this._pieceHeight = this.texture.height / this.row;\r\n        \r\n        this.m_sprite = this.getComponent(cc.Sprite);\r\n\r\n        this.m_sprite.spriteFrame = new cc.SpriteFrame(this.texture,new cc.Rect(0,this.rowIndex * this._pieceHeight,this._pieceWidth, this._pieceHeight),false,cc.v2(0,0),new cc.Size(this._pieceWidth,this._pieceHeight));\r\n\r\n        //this.m_sprite.spriteFrame.setTexture(this.texture,new cc.Rect(0,0,this._pieceWidth * j,i * this._pieceHeight),false,cc.v2(0,0),new cc.Size(this._pieceWidth,this._pieceHeight));\r\n\r\n        this.rect.width = this._pieceWidth;\r\n        this.rect.height = this._pieceHeight;\r\n\r\n        this.node.width = this._pieceWidth;\r\n        this.node.height = this._pieceHeight;\r\n\r\n        this.timer = this.interval;\r\n\r\n        this.running = this.autoPlayOnLoad;\r\n\r\n\r\n    }\r\n\r\n    update(dt)\r\n    {\r\n\r\n        if (!this.running)\r\n            return;\r\n\r\n        if (this.playTimes != 0 && this.currentTimes == this.playTimes)\r\n            return;\r\n\r\n        this.timer -= dt;\r\n\r\n        if (this.timer <= 0)\r\n        {\r\n\r\n            this.timer = this.interval;\r\n\r\n            this.currentFrame = this.currentFrame % this.col;\r\n\r\n            this.playAction();\r\n\r\n            this.currentFrame++;\r\n\r\n            if(this.currentFrame == this.col)\r\n            {\r\n\r\n                if(this.isAll)\r\n                {\r\n                    this.rowIndex++;\r\n\r\n                    if(this.rowIndex == this.row)\r\n                    {\r\n                        this.currentTimes ++;\r\n\r\n                        this.node.emit(\"completeTimes\");\r\n\r\n                        if (this.playTimes != 0 && this.currentTimes == this.playTimes)\r\n                        {\r\n                            this.node.emit(\"complete\");\r\n\r\n                            if(this.autoDestroy)\r\n                            {\r\n                                this.node.destroy();\r\n                            }\r\n                        }\r\n                    }\r\n\r\n                    this.rowIndex %= this.row;\r\n                }else\r\n                {\r\n                    this.currentTimes ++;\r\n\r\n                    this.node.emit(\"completeTimes\");\r\n\r\n                    if (this.playTimes != 0 && this.currentTimes == this.playTimes)\r\n                    {\r\n                        this.node.emit(\"complete\");\r\n\r\n                        if(this.autoDestroy)\r\n                        {\r\n                            this.node.destroy();\r\n                        }\r\n                    }\r\n                }\r\n\r\n            }\r\n        }\r\n \r\n    }\r\n\r\n\r\n    private playAction()\r\n    {\r\n        this.rowIndex = Mathf.clamp(this.rowIndex, 0, this.row - 1);\r\n\r\n        this._playIndex = this._playIndex % (this.begin - this.end) + this.begin;\r\n        //this.m_sprite.sprite = m_clips[rowIndex, _playIndex];\r\n\r\n        this.rect.x = this._playIndex * this._pieceWidth;\r\n        this.rect.y = this.rowIndex * this._pieceHeight;\r\n\r\n        this.m_sprite.spriteFrame.setRect(this.rect);\r\n        this._playIndex++;\r\n    }\r\n\r\n    /// <summary>\r\n    /// 播放影片\r\n    /// </summary>\r\n    public play()\r\n    {\r\n        this.running = true;\r\n    }\r\n\r\n    /// <summary>\r\n    /// 停止播放影片\r\n    /// </summary>\r\n    public stop()\r\n    {\r\n        this.running = false;\r\n    }\r\n\r\n    /// <summary>\r\n    /// 跳帧播放\r\n    /// </summary>\r\n    /// <param name=\"frame\">帧</param>\r\n    public gotoAndPlay(frame:number)\r\n    {\r\n        this.running = true;\r\n        this._playIndex = frame;\r\n        this._playIndex = Mathf.clamp(this._playIndex, 0, this.col - 1);\r\n\r\n    }\r\n\r\n    /// <summary>\r\n    /// 跳帧停止\r\n    /// </summary>\r\n    /// <param name=\"frame\">帧</param>\r\n    public gotoAndStop(frame:number)\r\n    {\r\n        this.running = false;\r\n\r\n        this._playIndex = frame;\r\n        this._playIndex = Mathf.clamp(this._playIndex, 0, this.col - 1);\r\n        \r\n        this.rect.x = this._playIndex * this._pieceWidth;\r\n        this.rect.y = this.rowIndex * this._pieceHeight;\r\n        this.m_sprite.spriteFrame.setRect(this.rect);\r\n    }\r\n\r\n}\r\n"]}