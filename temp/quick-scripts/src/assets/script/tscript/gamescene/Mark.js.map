{"version":3,"sources":["assets\\script\\tscript\\gamescene\\Mark.ts"],"names":[],"mappings":";;;;;AAAA,mCAAgD;AAGhD,oBAAoB;AACpB,kFAAkF;AAClF,yFAAyF;AACzF,mBAAmB;AACnB,4FAA4F;AAC5F,mGAAmG;AACnG,8BAA8B;AAC9B,4FAA4F;AAC5F,mGAAmG;AAE7F,IAAA,kBAAmC,EAAlC,oBAAO,EAAE,sBAAyB,CAAC;AAG1C;IAAkC,wBAAY;IAD9C;QAAA,qEA+GC;QA5GU,YAAM,GAAU,IAAI,CAAC;QAErB,kBAAY,GAAU,IAAI,CAAC;QAE3B,eAAS,GAAa,IAAI,CAAC;QAE3B,cAAQ,GAAW,IAAI,CAAC;QAEvB,cAAQ,GAAW,EAAE,CAAC,IAAI,CAAC,IAAI,CAAC;QAGxC;;WAEG;QACK,cAAQ,GAAW,EAAE,CAAC,IAAI,CAAC,IAAI,CAAC;QAKhC,gBAAU,GAAW,IAAI,CAAC;;IAyFtC,CAAC;IAvFG,wBAAwB;IAExB,eAAe;IAEf,oBAAK,GAAL;QAEI,IAAG,IAAI,CAAC,QAAQ,EAChB;YACI,IAAI,CAAC,YAAY,CAAC,EAAE,CAAC,MAAM,CAAC,CAAC,WAAW,GAAG,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,IAAI,CAAC,WAAW,CAAC;YACnF,IAAI,CAAC,UAAU,GAAG,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC;SAC5C;aACD;YACI,IAAI,CAAC,YAAY,CAAC,EAAE,CAAC,MAAM,CAAC,CAAC,WAAW,GAAG,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,WAAW,CAAC;YAC3E,IAAI,CAAC,UAAU,GAAG,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC;SACzC;QAED,IAAI,CAAC,QAAQ,CAAC,KAAK,GAAG,CAAC,EAAE,CAAC,OAAO,CAAC,KAAK,GAAG,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;QAC/D,IAAI,CAAC,QAAQ,CAAC,MAAM,GAAG,CAAC,EAAE,CAAC,OAAO,CAAC,MAAM,GAAG,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC;QAElE,IAAI,CAAC,SAAS,GAAG,EAAE,CAAC,EAAE,CAAC,IAAI,CAAC,QAAQ,CAAC,KAAK,EAAC,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,CAAC,GAAG,EAAE,CAAC;IAE3E,CAAC;IAEA,qBAAM,GAAN,UAAQ,EAAE;QAGP,IAAG,IAAI,CAAC,QAAQ,EAChB;YACI,IAAG,CAAC,IAAI,CAAC,YAAY,IAAI,CAAC,IAAI,CAAC,YAAY,CAAC,OAAO,IAAI,IAAI,CAAC,YAAY,CAAC,MAAM,IAAI,qBAAY,CAAC,GAAG,EACnG;gBACI,IAAI,CAAC,IAAI,CAAC,OAAO,EAAE,CAAC;gBACpB,OAAO;aACV;SAEJ;aACD;YACG,gDAAgD;SAClD;QAGD,IAAG,CAAC,IAAI,CAAC,MAAM,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,OAAO,EACvC;YACI,OAAO;SACV;QAED,IAAI,KAAK,GAAG,CAAC,GAAG,EAAE,CAAC,MAAM,CAAC,IAAI,CAAC,SAAS,CAAC;QAEzC,IAAI,CAAC,QAAQ,CAAC,KAAK,GAAG,CAAC,EAAE,CAAC,OAAO,CAAC,KAAK,GAAG,GAAG,CAAC,GAAG,KAAK,GAAG,CAAC,CAAE;QAC5D,IAAI,CAAC,QAAQ,CAAC,MAAM,GAAG,CAAC,EAAE,CAAC,OAAO,CAAC,MAAM,GAAG,GAAG,CAAC,GAAG,KAAK,GAAG,CAAC,CAAC;QAE5D,IAAI,GAAG,GAAG,IAAI,CAAC,UAAU,CAAC,QAAQ,CAAC,GAAG,CAAC,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;QAElE,IAAG,CAAC,GAAG,CAAC,CAAC,GAAG,CAAC,IAAI,CAAC,QAAQ,CAAC,KAAK,IAAI,GAAG,CAAC,CAAC,GAAG,IAAI,CAAC,QAAQ,CAAC,KAAK,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,GAAG,CAAC,IAAI,CAAC,QAAQ,CAAC,MAAM,IAAI,GAAG,CAAC,CAAC,GAAG,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,EACnI;YACI,eAAe;YACf,IAAI,CAAC,IAAI,CAAC,OAAO,GAAG,CAAC,CAAC;YACtB,OAAO;SACV;QAED,IAAI,CAAC,IAAI,CAAC,OAAO,GAAG,GAAG,CAAC;QAGxB,IAAI,KAAK,GAAU,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,EAAC,GAAG,CAAC,CAAC,CAAC,CAAC;QAE3C,IAAI,GAAG,GAAG,EAAE,CAAC,EAAE,CAAC,IAAI,CAAC,SAAS,GAAG,IAAI,CAAC,GAAG,CAAC,KAAK,CAAC,EAAC,IAAI,CAAC,SAAS,GAAG,IAAI,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC,CAAC;QAEnF,gBAAgB;QAEhB,IAAG,GAAG,CAAC,CAAC,GAAG,CAAC,IAAI,CAAC,QAAQ,CAAC,KAAK,EAC/B;YACI,GAAG,CAAC,CAAC,GAAG,CAAC,IAAI,CAAC,QAAQ,CAAC,KAAK,CAAC;SAChC;aAAK,IAAG,GAAG,CAAC,CAAC,GAAG,IAAI,CAAC,QAAQ,CAAC,KAAK,EACpC;YACI,GAAG,CAAC,CAAC,GAAG,IAAI,CAAC,QAAQ,CAAC,KAAK,CAAC;SAC/B;QAED,IAAG,GAAG,CAAC,CAAC,GAAG,CAAC,IAAI,CAAC,QAAQ,CAAC,MAAM,EAChC;YACI,GAAG,CAAC,CAAC,GAAG,CAAC,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC;SACjC;aAAK,IAAG,GAAG,CAAC,CAAC,GAAG,IAAI,CAAC,QAAQ,CAAC,MAAM,EACrC;YACI,GAAG,CAAC,CAAC,GAAG,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC;SAChC;QAED,IAAI,CAAC,IAAI,CAAC,QAAQ,GAAG,GAAG,CAAC;IAE7B,CAAC;IA7Ge,IAAI;QADxB,OAAO;OACa,IAAI,CA8GxB;IAAD,WAAC;CA9GD,AA8GC,CA9GiC,EAAE,CAAC,SAAS,GA8G7C;kBA9GoB,IAAI","file":"","sourceRoot":"/","sourcesContent":["import Player, { PlayerStatus } from \"./Player\";\r\nimport BlackHole from \"./BlackHole\";\r\n\r\n// Learn TypeScript:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/typescript.html\r\n//  - [English] http://www.cocos2d-x.org/docs/creator/manual/en/scripting/typescript.html\r\n// Learn Attribute:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\r\n//  - [English] http://www.cocos2d-x.org/docs/creator/manual/en/scripting/reference/attributes.html\r\n// Learn life-cycle callbacks:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\r\n//  - [English] http://www.cocos2d-x.org/docs/creator/manual/en/scripting/life-cycle-callbacks.html\r\n\r\nconst {ccclass, property} = cc._decorator;\r\n\r\n@ccclass\r\nexport default class Mark extends cc.Component {\r\n\r\n    public player:Player = null;\r\n\r\n    public targetPlayer:Player = null;\r\n\r\n    public blackHole:BlackHole = null;\r\n\r\n    public isPlayer:boolean = true;\r\n\r\n    private halfSize:cc.Size = cc.Size.ZERO;\r\n\r\n\r\n    /**\r\n     * 视野范围\r\n     */\r\n    private viewSize:cc.Size = cc.Size.ZERO;\r\n\r\n\r\n    private winRadius:number;\r\n\r\n    private targetNode:cc.Node = null;\r\n\r\n    // LIFE-CYCLE CALLBACKS:\r\n\r\n    // onLoad () {}\r\n\r\n    start () {\r\n\r\n        if(this.isPlayer)\r\n        {\r\n            this.getComponent(cc.Sprite).spriteFrame = this.targetPlayer.body.skin.spriteFrame;\r\n            this.targetNode = this.targetPlayer.node;\r\n        }else\r\n        {\r\n            this.getComponent(cc.Sprite).spriteFrame = this.blackHole.skin.spriteFrame;\r\n            this.targetNode = this.blackHole.node;\r\n        }\r\n        \r\n        this.halfSize.width = (cc.winSize.width - this.node.width) / 2;\r\n        this.halfSize.height = (cc.winSize.height - this.node.height) / 2;\r\n\r\n        this.winRadius = cc.v2(this.halfSize.width,this.halfSize.height).mag();\r\n\r\n    }\r\n\r\n     update (dt) \r\n     {\r\n\r\n        if(this.isPlayer)\r\n        {\r\n            if(!this.targetPlayer || !this.targetPlayer.isValid || this.targetPlayer.status == PlayerStatus.die)\r\n            {\r\n                this.node.destroy();\r\n                return;\r\n            }\r\n            \r\n        }else\r\n        {\r\n           //--------------------------------------------- \r\n        }\r\n        \r\n\r\n        if(!this.player || !this.player.isValid)\r\n        {\r\n            return;\r\n        }\r\n\r\n        var ratio = 1 / cc.Camera.main.zoomRatio;\r\n\r\n        this.viewSize.width = (cc.winSize.width + 160) * ratio / 2 ;\r\n        this.viewSize.height = (cc.winSize.height + 160) * ratio / 2;\r\n\r\n         var dir = this.targetNode.position.sub(this.player.node.position);\r\n\r\n         if((dir.x > -this.viewSize.width && dir.x < this.viewSize.width) && (dir.y > -this.viewSize.height && dir.y < this.viewSize.height))\r\n         {\r\n             //对手在视野范围内，隐藏标志\r\n             this.node.opacity = 0;\r\n             return;\r\n         }\r\n\r\n         this.node.opacity = 255;\r\n\r\n\r\n         var angle:number = Math.atan2(dir.y,dir.x);\r\n\r\n         var pos = cc.v2(this.winRadius * Math.cos(angle),this.winRadius * Math.sin(angle));\r\n\r\n         //var pos = dir;\r\n\r\n         if(pos.x < -this.halfSize.width)\r\n         {\r\n             pos.x = -this.halfSize.width;\r\n         }else if(pos.x > this.halfSize.width)\r\n         {\r\n             pos.x = this.halfSize.width;\r\n         }\r\n\r\n         if(pos.y < -this.halfSize.height)\r\n         {\r\n             pos.y = -this.halfSize.height;\r\n         }else if(pos.y > this.halfSize.height)\r\n         {\r\n             pos.y = this.halfSize.height;\r\n         }\r\n\r\n         this.node.position = pos;\r\n\r\n     }\r\n}\r\n"]}