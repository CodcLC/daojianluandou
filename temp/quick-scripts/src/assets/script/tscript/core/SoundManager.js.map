{"version":3,"sources":["assets\\script\\tscript\\core\\SoundManager.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import SoundClip, { SoundClipType } from \"../audio/SoundClip\";\r\nimport BgSoundClip, { BgSoundClipType } from \"../audio/BgSoundClip\";\r\n\r\n\r\n// Learn TypeScript:\r\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/typescript.html\r\n//  - [English] http://www.cocos2d-x.org/docs/creator/manual/en/scripting/typescript.html\r\n// Learn Attribute:\r\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\r\n//  - [English] http://www.cocos2d-x.org/docs/creator/manual/en/scripting/reference/attributes.html\r\n// Learn life-cycle callbacks:\r\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\r\n//  - [English] http://www.cocos2d-x.org/docs/creator/manual/en/scripting/life-cycle-callbacks.html\r\n\r\nconst {ccclass, property} = cc._decorator;\r\n\r\n@ccclass\r\nexport default class SoundManager extends cc.Component {\r\n\r\n    private static _instance: SoundManager;\r\n    public static get instance(): SoundManager {\r\n        if(this._instance == null)\r\n        {\r\n            /*cc.loader.loadRes(\"prefab/SoundManager\",cc.Prefab,(err,prefab)=>{\r\n                var node:cc.Node = cc.instantiate(prefab);\r\n                this._instance = node.getComponent(SoundManager);\r\n            });*/\r\n            //this._instance = new SoundManager();\r\n            //this._instance.init();\r\n        }\r\n        return SoundManager._instance;\r\n    }\r\n    \r\n    @property(cc.AudioSource)\r\n    private bgAS:cc.AudioSource = null;\r\n\r\n    private audioDic:{[key:number]:cc.AudioClip}\r\n\r\n    /// <summary>\r\n    /// 背景声音\r\n    /// </summary>\r\n    //@property(BgSoundClip)\r\n    //public bgSoundClips:BgSoundClip[] = [];\r\n    @property(cc.Node)\r\n    private bgSoundSrc:cc.Node = null;\r\n    private bgSoundDic:{[key:number]:BgSoundClip} = {};\r\n\r\n    @property(cc.Node)\r\n    private soundSrc:cc.Node = null;\r\n    private soundDic:{[key:number]:SoundClip} = {};\r\n\r\n    private lastBgSound:BgSoundClipType = BgSoundClipType.none;\r\n\r\n    private mute:boolean = false;\r\n\r\n    onLoad () \r\n    {\r\n        if(!SoundManager._instance)\r\n        {\r\n            SoundManager._instance = this;\r\n            cc.game.addPersistRootNode(this.node);\r\n            this.init();\r\n        }else\r\n        {\r\n            this.node.destroy();\r\n        }\r\n    }\r\n\r\n    private init()\r\n    {\r\n        var children:cc.Node[] = this.bgSoundSrc.children;\r\n        for (var i = 0; i < children.length; i++)\r\n        {\r\n            var bgSoundClip:BgSoundClip = children[i].getComponent(BgSoundClip);\r\n            this.bgSoundDic[bgSoundClip.type] = bgSoundClip;\r\n        }\r\n\r\n        children = this.soundSrc.children;\r\n        for (var i = 0; i < children.length; i++)\r\n        {\r\n            var soundClip:SoundClip = children[i].getComponent(SoundClip);\r\n            this.soundDic[soundClip.type] = soundClip;\r\n        }\r\n    }\r\n\r\n    public pause()\r\n    {\r\n        this.mute = true;\r\n        cc.audioEngine.pauseAll();\r\n        this.bgAS.pause();\r\n    }\r\n\r\n    public resume()\r\n    {\r\n        this.mute = false;\r\n        cc.audioEngine.resumeAll();\r\n        this.bgAS.resume();\r\n    }\r\n\r\n\r\n\r\n    public PlayBGSound(type:BgSoundClipType, loop:boolean = true)\r\n    {\r\n        if (this.lastBgSound == BgSoundClipType.none)\r\n            this.lastBgSound = type;\r\n        this.bgAS.stop();\r\n        this.bgAS.loop = loop;\r\n        this.bgAS.clip = this.getBGSoundClip(type);\r\n        if(!this.mute)\r\n        {\r\n            this.bgAS.play();\r\n        }\r\n    }\r\n\r\n\r\n    public getBGSoundClip(type:BgSoundClipType):cc.AudioClip\r\n    {\r\n        if (this.bgSoundDic[type])\r\n        {\r\n            return this.bgSoundDic[type].clip;\r\n        }\r\n        else\r\n        {\r\n            cc.log(\"不存在背景声音源 \", BgSoundClipType[type]);\r\n            return null;\r\n        }\r\n    }\r\n\r\n    public playAudioClip(type:SoundClipType)\r\n    {\r\n\r\n        if(this.mute)\r\n        {\r\n            return;\r\n        }\r\n\r\n        var name:string = SoundClipType[type];\r\n\r\n        var clip:cc.AudioClip = this.getSoundClip(type);\r\n\r\n        if (clip != null)\r\n        {\r\n            cc.audioEngine.play(clip,false,1);\r\n        }\r\n        else\r\n        {\r\n            cc.log(\"找不到资源id为 \" , type , \" PlayOtherSound声音配置\");\r\n        }\r\n        //\r\n    }\r\n\r\n    public getSoundClip(type:SoundClipType):cc.AudioClip\r\n    {\r\n        if (this.soundDic[type])\r\n        {\r\n            return this.soundDic[type].clip;\r\n        }\r\n        else\r\n        {\r\n            cc.log(\"不存在该种声音源 \" + SoundClipType[type]);\r\n            return null;\r\n        }\r\n    }\r\n    // update (dt) {}\r\n}\r\n"]}