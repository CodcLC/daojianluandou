{"version":3,"sources":["assets\\script\\tscript\\ui\\main\\MatchingUI.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import BaseUI from \"../base/BaseUI\";\r\nimport Random from \"../../util/Random\";\r\nimport GameManager from \"../../core/GameManager\";\r\nimport GameScene from \"../../gamescene/GameScene\";\r\nimport ResourcesManager from \"../../core/ResourcesManager\";\r\nimport DataManager from \"../../core/DataManager\";\r\nimport WXSdk from \"../../wx/WXSdk\";\r\n\r\n// Learn TypeScript:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/typescript.html\r\n//  - [English] http://www.cocos2d-x.org/docs/creator/manual/en/scripting/typescript.html\r\n// Learn Attribute:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\r\n//  - [English] http://www.cocos2d-x.org/docs/creator/manual/en/scripting/reference/attributes.html\r\n// Learn life-cycle callbacks:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\r\n//  - [English] http://www.cocos2d-x.org/docs/creator/manual/en/scripting/life-cycle-callbacks.html\r\n\r\nconst {ccclass, property} = cc._decorator;\r\n\r\n@ccclass\r\nexport default class MatchingUI extends BaseUI {\r\n\r\n    @property(cc.Node)\r\n    otherUsers: cc.Node[] = [];\r\n\r\n    @property(cc.Node)\r\n    dotArr: cc.Node[] = [];\r\n\r\n    @property\r\n    public radius:number = 220;\r\n\r\n    \r\n    private gameSceme:GameScene = null;\r\n\r\n    // LIFE-CYCLE CALLBACKS:\r\n    \r\n\r\n    // onLoad () {}\r\n\r\n    start () {\r\n\r\n        this.gameSceme = GameManager.instance.gameScene.getComponent(GameScene);\r\n\r\n        var angle:number = 2 * Math.PI / this.otherUsers.length;\r\n\r\n        var idArr = [];\r\n\r\n        for(var i = 1 ; i < this.otherUsers.length ; i++)\r\n        {\r\n            let node:cc.Node = this.otherUsers[i];\r\n            node.active = false;\r\n        }\r\n\r\n        for(var i = 1 ; i <= 50 ; i++)\r\n        {\r\n            idArr.push(i);\r\n        }\r\n\r\n\r\n        this.scheduleOnce(()=>\r\n        {\r\n\r\n            if(WXSdk.instance.isWXPlatform())\r\n            {\r\n\r\n                if(WXSdk.instance.isLogin)\r\n                {\r\n                    this.onWxLogin();\r\n                }else\r\n                {\r\n                    cc.systemEvent.on(\"wxLogin\",this.onWxLogin,this);\r\n                }\r\n            }\r\n\r\n            for(var i = 1 ; i < this.otherUsers.length ; i++)\r\n            {\r\n                let node:cc.Node = this.otherUsers[i];\r\n                node.active = false;\r\n\r\n                let id:number = this.gameSceme.aiNameIndexArr[i - 1];\r\n\r\n\r\n                ResourcesManager.instance.load(`headIcon/${id}`,(spriteFrame:cc.SpriteFrame)=>{\r\n\r\n                    if(spriteFrame)\r\n                    {\r\n                        node.getComponent(cc.Sprite).spriteFrame = spriteFrame;\r\n                    }\r\n\r\n                    node.getChildByName(\"NameTxt\").getComponent(cc.Label).string = DataManager.instance.nameConfigDatas[id].name;\r\n                    \r\n                },cc.SpriteFrame,false,false);\r\n\r\n            }\r\n\r\n        },0.1);\r\n\r\n    }\r\n\r\n\r\n    public open()\r\n    {\r\n        super.open();\r\n\r\n        var t:number = Random.Range(2.5,4.8);\r\n\r\n        this.scheduleOnce(()=>{\r\n\r\n            GameManager.instance.gameScene.getComponent(GameScene).startGame();\r\n            this.close();\r\n\r\n        },t + 1.5);\r\n\r\n\r\n        var n = this.otherUsers.length + Random.RangeInteger(2,8);\r\n\r\n        var idArr:number[] = [];\r\n        for(var i = 0 ; i < n ; i++)\r\n        {\r\n            idArr.push(i);\r\n        }\r\n\r\n\r\n        this.schedule(()=>{\r\n            \r\n            var index = Random.RangeInteger(0,idArr.length);\r\n            var id:number = idArr[index];\r\n\r\n            if(this.otherUsers[id])\r\n            {\r\n                this.otherUsers[id].active = true;\r\n            }\r\n\r\n            idArr.splice(index,1);\r\n\r\n\r\n        },t/n,n - 1);\r\n\r\n        for(var j = 0 ; j < this.dotArr.length; j++)\r\n        {\r\n            this.dotArr[j].active = false;\r\n        }\r\n\r\n\r\n        var i:number = 0;\r\n        this.schedule(()=>{\r\n  \r\n            for(var j = 0 ; j < this.dotArr.length; j++)\r\n            {\r\n                this.dotArr[j].active = (j < i);\r\n            }\r\n\r\n            i++;\r\n            i %= this.dotArr.length + 1;\r\n\r\n        },0.25,20);\r\n    }\r\n\r\n    private onWxLogin()\r\n    {\r\n        this.otherUsers[0].active = false;\r\n        \r\n        WXSdk.instance.getUserIcon((texture:cc.Texture2D)=>{\r\n            this.otherUsers[0].active = true;\r\n            var headIcon:cc.Sprite = this.otherUsers[0].getChildByName(\"Mask\").getChildByName(\"HeadIcon\").getComponent(cc.Sprite);\r\n            headIcon.spriteFrame = new cc.SpriteFrame(texture);\r\n            this.otherUsers[0].getChildByName(\"NameTxt\").getComponent(cc.Label).string = WXSdk.instance.nickname;\r\n\r\n        },64);\r\n    }\r\n\r\n    onDestroy()\r\n    { \r\n        cc.systemEvent.off(\"wxLogin\",this.onWxLogin,this);   \r\n    }\r\n\r\n    // update (dt) {}\r\n}\r\n"]}